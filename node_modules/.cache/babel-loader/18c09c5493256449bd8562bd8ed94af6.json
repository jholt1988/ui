{"ast":null,"code":"const passport = require('passport');\n\nconst LocalStrategy = require('passport-local');\n\nconst Auth = require('../Services/AuthService');\n\nconst logger = require('morgan');\n\nconst {\n  User\n} = require('../db');\n\nconst {\n  chain\n} = require('lodash');\n\nmodule.exports = app => {\n  app.use(passport.initialize());\n  app.use(passport.session());\n  app.use(logger('combined'));\n  passport.serializeUser((user, done) => {\n    console.log(`${user} serialized`);\n    return done(null, user.id);\n  });\n  passport.deserializeUser((id, done) => {\n    User.findByPk(id).then(user => {\n      return done(null, {\n        id\n      });\n    });\n  });\n  passport.use('local', new LocalStrategy(function (username, password, done) {\n    authUser = User.findOne({\n      where: {\n        username: username\n      }\n    }).then(user => {\n      hashpass = user ? user.password : \"\";\n      isMatch = User.validatePassword(password, hashpass, done, user);\n      return done(null, user);\n    });\n  }));\n  return passport;\n};","map":{"version":3,"sources":["C:/Users/jorda/OneDrive/Desktop/berecoapp/node_modules/berecoapi2.0/Loaders/passport.js"],"names":["passport","require","LocalStrategy","Auth","logger","User","chain","module","exports","app","use","initialize","session","serializeUser","user","done","console","log","id","deserializeUser","findByPk","then","username","password","authUser","findOne","where","hashpass","isMatch","validatePassword"],"mappings":"AAAA,MAAMA,QAAQ,GAAGC,OAAO,CAAC,UAAD,CAAxB;;AACA,MAAMC,aAAa,GAAGD,OAAO,CAAC,gBAAD,CAA7B;;AACA,MAAME,IAAI,GAAGF,OAAO,CAAC,yBAAD,CAApB;;AACA,MAAMG,MAAM,GAAGH,OAAO,CAAC,QAAD,CAAtB;;AACA,MAAM;AAAEI,EAAAA;AAAF,IAAWJ,OAAO,CAAC,OAAD,CAAxB;;AACA,MAAM;AAAEK,EAAAA;AAAF,IAAYL,OAAO,CAAC,QAAD,CAAzB;;AAGAM,MAAM,CAACC,OAAP,GAAkBC,GAAD,IAAS;AACtBA,EAAAA,GAAG,CAACC,GAAJ,CAAQV,QAAQ,CAACW,UAAT,EAAR;AACAF,EAAAA,GAAG,CAACC,GAAJ,CAAQV,QAAQ,CAACY,OAAT,EAAR;AACAH,EAAAA,GAAG,CAACC,GAAJ,CAAQN,MAAM,CAAC,UAAD,CAAd;AAEAJ,EAAAA,QAAQ,CAACa,aAAT,CAAuB,CAACC,IAAD,EAAOC,IAAP,KAAgB;AACnCC,IAAAA,OAAO,CAACC,GAAR,CAAa,GAAEH,IAAK,aAApB;AACD,WAAQC,IAAI,CAAC,IAAD,EAAOD,IAAI,CAACI,EAAZ,CAAZ;AACE,GAHL;AAMAlB,EAAAA,QAAQ,CAACmB,eAAT,CAAyB,CAACD,EAAD,EAAKH,IAAL,KAAc;AACnCV,IAAAA,IAAI,CAACe,QAAL,CAAeF,EAAf,EAAoBG,IAApB,CAAyBP,IAAI,IAAG;AAE9B,aAAQC,IAAI,CAAC,IAAD,EAAO;AAAEG,QAAAA;AAAF,OAAP,CAAZ;AACD,KAHD;AAIC,GALL;AAUAlB,EAAAA,QAAQ,CAACU,GAAT,CAAa,OAAb,EAAsB,IAAIR,aAAJ,CAClB,UAAUoB,QAAV,EAAoBC,QAApB,EAA8BR,IAA9B,EAAoC;AAEhCS,IAAAA,QAAQ,GAAGnB,IAAI,CAACoB,OAAL,CAAa;AAAEC,MAAAA,KAAK,EAAE;AAAEJ,QAAAA,QAAQ,EAAEA;AAAZ;AAAT,KAAb,EAAgDD,IAAhD,CAAqDP,IAAI,IAAI;AACpEa,MAAAA,QAAQ,GAAGb,IAAI,GAAGA,IAAI,CAACS,QAAR,GAAmB,EAAlC;AACAK,MAAAA,OAAO,GAAGvB,IAAI,CAACwB,gBAAL,CAAsBN,QAAtB,EAAgCI,QAAhC,EAA0CZ,IAA1C,EAAgDD,IAAhD,CAAV;AACD,aAAOC,IAAI,CAAC,IAAD,EAAOD,IAAP,CAAX;AACF,KAJU,CAAX;AAQH,GAXiB,CAAtB;AAiBA,SAAOd,QAAP;AAEH,CAxCD","sourcesContent":["const passport = require('passport');\r\nconst LocalStrategy = require('passport-local')\r\nconst Auth = require('../Services/AuthService');\r\nconst logger = require('morgan');\r\nconst { User } = require('../db');\r\nconst { chain } = require('lodash');\r\n\r\n\r\nmodule.exports = (app) => {\r\n    app.use(passport.initialize());\r\n    app.use(passport.session());\r\n    app.use(logger('combined'))\r\n\r\n    passport.serializeUser((user, done) => {\r\n        console.log(`${user} serialized`)\r\n       return  done(null, user.id)\r\n        })\r\n    \r\n\r\n    passport.deserializeUser((id, done) => {\r\n        User.findByPk( id ).then(user=> {\r\n            \r\n          return  done(null, { id })\r\n        })\r\n        })\r\n        \r\n        \r\n    \r\n\r\n    passport.use('local', new LocalStrategy(\r\n        function (username, password, done) {\r\n        \r\n            authUser = User.findOne({ where: { username: username } }).then(user => {\r\n                hashpass = user ? user.password : \"\"\r\n                isMatch = User.validatePassword(password, hashpass, done, user)\r\n               return done(null, user)\r\n            })\r\n\r\n    \r\n            \r\n        })\r\n    )\r\n    \r\n        \r\n                \r\n                    \r\n    return passport\r\n                \r\n}"]},"metadata":{},"sourceType":"script"}